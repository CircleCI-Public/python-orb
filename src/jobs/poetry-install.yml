description: >
  Setup a poetry based environment with 'poetry install'

executor:
  name: default
  tag: << parameters.version >>

parameters:
  args:
    description: "Run poetry install with args"
    type: string
    default: ""
  venv-cache:
    description: "Use the lockfile to save the deps. If the lockfile changes we reinstall anyway."
    type: boolean
    default: false
  pypi-cache:
    description: "Keep the global pypi package caches for faster rebuilding overall."
    type: boolean
    default: true
  app-dir:
    type: string
    default: "~/project"
    description: Path to the directory to checkout the python project
  version:
    type: string
    default: "3.8"
    description: |
      A full version tag must be specified. Example: "3.8"
      For a full list of releases, see the following: https://hub.docker.com/r/cimg/python
steps:
  - attach_workspace:
      at: << parameters.app-dir >>
  - checkout
  - install-advanced:
      tool: poetry
      args: << parameters.args >>
      pypi-cache: << parameters.pypi-cache >>
      venv-cache: << parameters.venv-cache >>
